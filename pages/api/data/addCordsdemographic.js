import mysql from 'mysql2'

const pool = mysql.createPool({
  host: process.env.HOST,
  user: process.env.USER,
  password: process.env.PASSWORD,
  database: process.env.DATABASE,
  connectionLimit: process.env.CONNECTION_LIMIT, // Adjust this value as per your requirements
})

// Create a reusable connection from the pool
const getConnection = () => {
  return new Promise((resolve, reject) => {
    pool.getConnection((error, connection) => {
      if (error) {
        reject(error)
      } else {
        resolve(connection)
      }
    })
  })
}

export default async function handler(req, res) {
  const cities = [
    ['Los Angeles, CA', 34.0522, 118.2437],
    ['Cerritos, CA', 33.8644, 118.0539],
    ['Fullerton, CA', 33.8704, 117.9243],
    ['San Joaquin, CA', 36.6073, 120.1894],
    ['Riverside, CA', 33.9806, 117.3755],
    ['Moreno Valley, CA', 33.9425, 117.2297],
    ['Marin City, CA', 37.8724, 122.5026],
    ['Watsonville, CA', 36.9102, 121.7569],
    ['Fresno, CA', 36.7372, 119.7871],
    ['Sacramento County, CA', 38.4747, 121.3542],
    ['San Mateo, CA', 37.562, 122.3255],
    ['San Bernardino, CA', 34.1083, 117.2898],
    ['San Diego, CA', 32.7157, 117.1611],
    ['Chula Vista, CA', 32.6401, 117.0842],
    ['Imperial Beach, CA', 32.5839, 117.1131],
    ['Redding, CA', 40.5865, 122.3917],
    ['Humboldt County, CA', 40.745, 123.8695],
    ['El Dorado Hills, CA', 38.6839, 121.0822],
    ['Monterey Park, CA', 34.0625, 118.1228],
    ['Monterey, CA', 36.6002, 121.8947],
    ['San Luis Obispo, CA', 35.2828, 120.6596],
    ['Orange, CA', 33.7879, 117.8531],
    ['Anaheim, CA', 33.8366, 117.9143],
    ['Irvine, CA', 33.6846, 117.8265],
    ['Garden Grove, CA', 33.7739, 117.9414],
    ['Huntington Beach, CA', 33.6603, 117.9992],
    ['Bellflower, CA', 33.8817, 118.117],
    ['Lakewood, CA', 33.8536, 118.1339],
    ['Rancho Cucamonga, CA', 34.1064, 117.5931],
    ['Rancho Palos Verdes, CA', 33.7445, 118.387],
    ['Manhattan Beach, CA', 33.8847, 118.4109],
    ['El Segundo, CA', 33.9192, 118.4165],
    ['Culver City, CA', 34.0211, 118.3965],
    ['Santa Monica, CA', 34.0194, 118.4912],
    ['Santa Maria, CA', 34.953, 120.4357],
    ['Eureka, CA', 40.8021, 124.1637],
    ['Davis, CA', 38.5449, 121.7405],
    ['Oakland, CA', 37.8044, 122.2711],
    ['San Francisco, CA', 37.7749, 122.4194],
    ['Santa Clara, CA', 37.3541, 121.9552],
    ['Santa Clarita, CA', 34.3917, 118.5426],
    ['Norwalk, CA', 33.9022, 118.0817],
    ['Commerce, CA', 34.0006, 118.1561],
    ['Industry, CA', 34.0197, 117.9587],
    ['Compton, CA', 33.8958, 118.2201],
    ['Inglewood, CA', 33.9617, 118.3531],
    ['Hawthorne, CA', 33.9164, 118.3526],
    ['Adelanto, CA', 34.5828, 117.4092],
    ['Menifee, CA', 33.6971, 117.1853],
    ['Corona, CA', 33.8753, 117.5664],
    ['Palmdale, CA', 34.5794, 118.1165],
    ['Palm Springs, CA', 33.8303, 116.5453],
    ['Palm Desert, CA', 33.7222, 116.3745],
    ['Jurupa Valley, CA', 33.9972, 117.4855],
    ['Gardena, CA', 33.8883, 118.3089],
    ['Laguna Hills, CA', 33.591, 117.7009],
    ['Laguna Niguel, CA', 33.5225, 117.7076],
    ['Aliso Viejo, CA', 33.5685, 117.7263],
    ['Oceanside, CA', 33.1959, 117.3795],
    ['Baldwin Park, CA', 34.0853, 117.9609],
    ['East Los Angeles, CA', 34.0224, 118.1669],
    ['Corning, CA', 39.9273, 122.179],
    ['Santa Rosa, CA', 38.4405, 122.7141],
    ['Yuba City, CA', 39.1404, 121.6169],
    ['Santa Cruz, CA', 36.9741, 122.0308],
    ['Rialto, CA', 34.1064, 117.3703],
    ['Upland, CA', 34.0975, 117.6484],
    ['Glendora, CA', 34.1361, 117.8653],
    ['Pasadena, CA', 34.1478, 118.1445],
    ['Alhambra, CA', 34.0953, 118.127],
    ['Bell Gardens, CA', 33.9653, 118.1515],
    ['Beverly Hills, CA', 34.0696, 118.4056],
    ['Burbank, Los Angeles County, CA', 34.1808, 118.3089],
    ['Calabasas, CA', 34.1367, 118.6615],
    ['Carson, CA', 33.8314, 118.282],
    ['Covina, CA', 34.09, 117.8903],
    ['Claremont, CA', 34.0967, 117.7198],
    ['Downey, CA', 33.94, 118.1339],
    ['Duarte, CA', 34.1395, 117.9773],
    ['El Monte, CA', 34.0686, 118.0276],
    ['Glendale, CA', 34.1425, 118.2551],
    ['Hermosa Beach, CA', 33.8622, 118.3995],
    ['Hidden Hills, CA', 34.1689, 118.6526],
    ['Huntington Park, CA', 33.9817, 118.2251],
    ['Irwindale, CA', 34.1164, 117.9555],
    ['La Ca√±ada Flintridge, CA', 34.2068, 118.2],
    ['La Mirada, CA', 33.9172, 118.012],
    ['La Puente, CA', 34.02, 117.9495],
    ['La Verne, CA', 34.1008, 117.7678],
    ['Lancaster, CA', 34.6868, 118.1542],
    ['Lawndale, CA', 33.8872, 118.3526],
    ['Lomita, CA', 33.7922, 118.3151],
    ['Long Beach, CA', 33.7701, 118.1937],
    ['Lynwood, CA', 33.9303, 118.2115],
    ['Malibu, CA', 34.0259, 118.7798],
    ['Maywood, CA', 33.9867, 118.1853],
    ['Monrovia, CA', 34.1449, 118.0019],
    ['Montebello, CA', 34.0165, 118.1138],
    ['San Dimas, CA', 34.1067, 117.8067],
    ['Pico Rivera, CA', 33.9831, 118.0967],
    ['Pomona, CA', 34.0551, 117.7499],
    ['Redondo Beach, CA', 33.8492, 118.3884],
    ['Rosemead, CA', 34.0806, 118.0728],
    ['San Fernando, CA', 34.2819, 118.439],
    ['San Gabriel, CA', 34.0961, 118.1058],
    ['San Marino, CA', 34.1224, 118.1132],
    ['Santa Fe Springs, CA', 33.9472, 118.0859],
    ['Sierra Madre, CA', 34.1617, 118.05],
    ['Signal Hill, CA', 33.8045, 118.1678],
    ['South Gate, CA', 33.9547, 118.212],
    ['South Pasadena, CA', 34.1161, 118.1504],
    ['Temple City, CA', 34.1072, 118.0578],
    ['Torrance, CA', 33.835, 118.3406],
    ['Walnut, CA', 34.0203, 117.8653],
    ['West Covina, CA', 34.0686, 117.9389],
    ['West Hollywood, CA', 34.09, 118.3617],
    ['Westlake Village, CA', 34.1458, 118.8056],
    ['Whittier, CA', 33.9792, 118.0328],
    ['La Habra, CA', 33.9319, 117.9461],
    ['La Habra Heights, CA', 33.9603, 117.9434],
    ['Brea, CA', 33.9167, 117.9001],
    ['Buena Park, CA', 33.8675, 117.9981],
    ['Costa Mesa, CA', 33.6411, 117.9187],
    ['Cypress, CA', 33.8169, 118.0373],
    ['Dana Point, CA', 33.4672, 117.6981],
    ['Fountain Valley, CA', 33.709, 117.9537],
    ['Los Alamitos, CA', 33.8031, 118.0706],
    ['Mission Viejo, CA', 33.6, 117.6719],
    ['Newport Beach, CA', 33.6189, 117.9298],
    ['Placentia, CA', 33.8722, 117.8703],
    ['San Clemente, CA', 33.4269, 117.6119],
    ['San Juan Capistrano, CA', 33.5017, 117.6626],
    ['Santa Ana, CA', 33.7455, 117.8677],
    ['Seal Beach, CA', 33.7414, 118.1048],
    ['Stanton, CA', 33.8025, 117.9931],
    ['Tustin, CA', 33.7456, 117.8262],
    ['Westminster, CA', 33.7517, 118.0067],
    ['Yorba Linda, CA', 33.8886, 117.8133],
    ['Villa Park, CA', 33.814, 117.8095],
    ['Banning, CA', 33.9256, 116.8764],
    ['Beaumont, CA', 33.9295, 116.9772],
    ['Blythe, CA', 33.6103, 114.5963],
    ['Calimesa, CA', 33.9924, 117.0618],
    ['Canyon Lake, CA', 33.6857, 117.2684],
    ['Cathedral City, CA', 33.7797, 116.4653],
    ['Coachella, CA', 33.6803, 116.1739],
    ['Desert Hot Springs, CA', 33.9611, 116.5017],
    ['Eastvale, CA', 33.9525, 117.5848],
    ['Hemet, CA', 33.7475, 116.971],
    ['Indian Wells, CA', 33.717, 116.3345],
    ['Indio, CA', 33.7206, 116.2156],
    ['Lake Elsinore, CA', 33.6681, 117.3273],
    ['La Quinta, CA', 33.6634, 116.31],
    ['Menifee, CA', 33.7283, 117.1546],
    ['Moreno Valley, CA', 33.9425, 117.2297],
    ['Murrieta, CA', 33.5539, 117.2139],
    ['Norco, CA', 33.917, 117.5484],
    ['Palm Desert, CA', 33.7222, 116.3745],
    ['Palm Springs, CA', 33.8303, 116.5453],
    ['Perris, CA', 33.7825, 117.2286],
    ['Rancho Mirage, CA', 33.7385, 116.4086],
    ['Riverside, CA', 33.9806, 117.3755],
    ['San Jacinto, CA', 33.7839, 116.9586],
    ['Temecula, CA', 33.4936, 117.1484],
    ['Wildomar, CA', 33.5989, 117.2809],
    ['Adelanto, CA', 34.5828, 117.4092],
    ['Apple Valley, CA', 34.5008, 117.1859],
    ['Barstow, CA', 34.8958, 117.0173],
    ['Big Bear Lake, CA', 34.2439, 116.9114],
    ['Chino, CA', 34.0122, 117.6889],
    ['Chino Hills, CA', 33.9898, 117.7326],
    ['Colton, CA', 34.0739, 117.3137],
    ['Crestline, CA', 34.2489, 117.2854],
    ['Fontana, CA', 34.0922, 117.435],
    ['Grand Terrace, CA', 34.0336, 117.3137],
    ['Hesperia, CA', 34.4264, 117.3009],
    ['Highland, CA', 34.1283, 117.2086],
    ['Loma Linda, CA', 34.0484, 117.2619],
    ['Montclair, CA', 34.0775, 117.6898],
    ['Needles, CA', 34.8482, 114.6141],
    ['Ontario, CA', 34.0633, 117.6509],
    ['Rancho Cucamonga, CA', 34.1064, 117.5931],
    ['Redlands, CA', 34.0556, 117.1825],
    ['Rialto, CA', 34.1064, 117.3703],
    ['San Bernardino, CA', 34.1083, 117.2898],
    ['Twentynine Palms, CA', 34.1356, 116.0542],
    ['Upland, CA', 34.0975, 117.6484],
    ['Victorville, CA', 34.5361, 117.2912],
    ['Yucaipa, CA', 34.0336, 117.0431],
    ['Yucca Valley, CA', 34.1142, 116.4322],
    ['Banning, CA', 33.9256, 116.8764],
    ['Beaumont, CA', 33.9295, 116.9775],
    ['Blythe, CA', 33.6175, 114.5889],
    ['Calimesa, CA', 33.9894, 117.0431],
    ['Canyon Lake, CA', 33.6857, 117.2673],
    ['Cathedral City, CA', 33.7797, 116.4653],
    ['Coachella, CA', 33.6803, 116.1739],
    ['Desert Hot Springs, CA', 33.9611, 116.5017],
    ['Eastvale, CA', 33.9525, 117.5848],
    ['Hemet, CA', 33.7475, 116.971],
    ['Indian Wells, CA', 33.717, 116.3345],
    ['Indio, CA', 33.7206, 116.2156],
    ['Lake Elsinore, CA', 33.6681, 117.3273],
    ['La Quinta, CA', 33.6634, 116.31],
    ['Menifee, CA', 33.7283, 117.1546],
    ['Moreno Valley, CA', 33.9425, 117.2297],
    ['Murrieta, CA', 33.5539, 117.2139],
    ['Norco, CA', 33.917, 117.5484],
    ['Palm Desert, CA', 33.7222, 116.3745],
    ['Palm Springs, CA', 33.8303, 116.5453],
    ['Perris, CA', 33.7825, 117.2286],
    ['Rancho Mirage, CA', 33.7385, 116.4086],
    ['Riverside, CA', 33.9806, 117.3755],
    ['San Jacinto, CA', 33.7839, 116.9586],
    ['Temecula, CA', 33.4936, 117.1484],
    ['Wildomar, CA', 33.5989, 117.2809],
    ['Adelanto, CA', 34.5828, 117.4092],
    ['Apple Valley, CA', 34.5008, 117.1859],
    ['Barstow, CA', 34.8958, 117.0173],
    ['Big Bear Lake, CA', 34.2439, 116.9114],
    ['Chino, CA', 34.0122, 117.6889],
    ['Chino Hills, CA', 33.9898, 117.7326],
    ['Colton, CA', 34.0739, 117.3137],
    ['Fontana, CA', 34.0922, 117.435],
    ['Grand Terrace, CA', 34.0336, 117.3136],
    ['Hesperia, CA', 34.4264, 117.3009],
    ['Highland, CA', 34.1283, 117.2086],
    ['Loma Linda, CA', 34.0483, 117.2612],
    ['Montclair, CA', 34.0775, 117.6898],
    ['Ontario, CA', 34.0633, 117.6509],
    ['Rancho Cucamonga, CA', 34.1064, 117.5931],
    ['Redlands, CA', 34.0556, 117.1825],
    ['Rialto, CA', 34.1064, 117.3703],
    ['San Bernardino, CA', 34.1083, 117.2898],
    ['Twentynine Palms, CA', 34.1356, 116.0542],
    ['Upland, CA', 34.0975, 117.6484],
    ['Victorville, CA', 34.5361, 117.2912],
    ['Yucaipa, CA', 34.0336, 117.0431],
    ['Yucca Valley, CA', 34.1142, 116.4322],
    ['Alturas, CA', 41.487, 120.5425],
    ['Dorris, CA', 41.965, 121.9214],
    ['Dunsmuir, CA', 41.2092, 122.2722],
    ['Etna, CA', 41.4575, 122.8956],
    ['Fort Jones, CA', 41.6011, 122.8331],
    ['Montague, CA', 41.7278, 122.5267],
    ['Mount Shasta, CA', 41.3108, 122.3088],
    ['Tulelake, CA', 41.9544, 121.475],
    ['Weed, CA', 41.4236, 122.386],
    ['Yreka, CA', 41.7354, 122.633],
    ['Auburn, CA', 38.8966, 121.0769],
    ['Colfax, CA', 39.0959, 120.9532],
    ['Lincoln, CA', 38.8916, 121.293],
    ['Rocklin, CA', 38.7907, 121.2358],
    ['Roseville, CA', 38.7521, 121.288],
  ]

  function formatCoordinates(dataPoints) {
    const coordinates = []

    for (const dataPoint of dataPoints) {
      const [city, lat, lon] = dataPoint

      const coordinate = {
        city: city,
        lat: lat,
        lon: lon,
      }

      coordinates.push(coordinate)
    }

    return coordinates
  }

  const formatedCities = formatCoordinates(cities)

  try {
    const connection = await getConnection()
    for (const item of formatedCities) {
      const { city, lat, lon } = item
      const updateQuery = `UPDATE Demographic_Data_1 SET lat = ${lat}, lon = ${lon} WHERE city = '${city}'`
      connection.query(updateQuery, (error, results) => {
        if (error) {
          // Handle query error
          console.error('Error executing query:', error)
        }
      })
    }

    connection.release() // Release the connection back to the pool
    res.json({ message: 'Data updated successfully' })
  } catch (error) {
    // Handle connection error
    console.error('Error connecting to database:', error)
    res.status(500).json({ error: 'Internal Server Error' })
  }
}
